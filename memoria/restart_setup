#!/bin/bash

log () {
  echo "[$(date '+%Y-%m-%d %H:%M:%S')]: $1"
}

function check_env () {
  if [[ ! ${!1} ]]; then
    log "Environment variable '$1' not set!"
    exit
  fi
}

PUBLIC="/share/MD0_DATA/Public"
source "$PUBLIC/bin/.custom_profile"
check_env USER_HOME
check_env MBIN

log " == sym links"
function safelink {
  if [[ ! -e "$1" ]]; then
    log "Create link $1 to $2"
    ln -s "$2" "$1"
  else
    log "Link already exists: $1"
  fi
}

safelink "$USER_HOME/media" "$PUBLIC/media"
safelink "$USER_HOME/bin" "$PUBLIC/bin"
safelink "$USER_HOME/data" "$PUBLIC/data"
safelink "$MBIN/set_title" "$MBIN/../haumea/set_title"
safelink "$MBIN/haumea" "$MBIN/../mercury/haumea"

log " == .bash_profile appendices"
BRC="$USER_HOME/.bash_profile"

function appendLine {
  log "Adding \"$1\" to $2"
  echo "$1" >> "$BRC"
}

appendLine "##### restart setup appendices:"
appendLine "export PS1=\"\\n\\[\\033[1;34m\\]\\u@\\h\\[\\033[00m\\] \\[\\033[0;32m\\]\\w\\[\\033[00m\\]\\n\\$ \""
appendLine "alias shutdown=\"halt\""
appendLine "bind 'set mark-symlinked-directories on'"
