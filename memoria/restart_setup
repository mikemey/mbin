#!/bin/bash

USER_HOME="/root"
PUBLIC="/share/MD0_DATA/Public"
BRC=$USER_HOME/.bash_profile

function appendLine {
  echo "Adding \"$1\" to $BRC"
  echo "$1" >> $BRC
}

echo -e "\n ======================================"
echo " == env variables"
echo " ======================================"

function appendEnv {
  ENV_KEY="$1"
  ENV_VAL="$2"
  NEW_LINE="export $ENV_KEY=$ENV_VAL"
  if grep -sq "^${NEW_LINE/ /\s}$" $BRC
  then
    echo "$ENV_KEY is already set."
  else
    appendLine "$NEW_LINE"
  fi
}

appendEnv "WEB_DIR" "/share/Web"
MBIN="$PUBLIC/bin/mbin/memoria"
PATHS="$MBIN/paths"
appendEnv "MBIN" "$MBIN"
appendEnv "PATH" "/Apps/bin:\$PATH"
appendEnv "PATH" "\$MBIN:\$PATH"

while IFS= read -r var
do
  echo $var
  appendEnv $var
done < "$PATHS"

echo -e "\n ======================================"
echo " == sym links"
echo " ======================================"

function safelink {
  if [ ! -d "$1" ]; then
    echo "Create link to $2"
    ln -s $2 $1
  else
    echo "Link already exists: $1"
  fi
}

safelink $USER_HOME/media $PUBLIC/media
safelink $USER_HOME/bin $PUBLIC/bin
safelink $USER_HOME/data $PUBLIC/data
safelink $MBIN/set_title $MBIN/../haumea/set_title
safelink $MBIN/haumea $MBIN/../mercury/haumea

echo -e "\n ======================================"
echo " == line appendices"
echo " ======================================"

appendLine "export PS1=\"\\[\\033[1;34m\\]\\u@\\h\\[\\033[00m\\] \\[\\033[0;32m\\]\\w\\[\\033[00m\\] \\$ \""
appendLine "alias shutdown=\"halt\""
appendLine "bind 'set mark-symlinked-directories on'"
